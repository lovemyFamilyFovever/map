<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/esri-leaflet@3.0.2/dist/esri-leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
</head>

<body>
    <div id="map" style="height: 1080px"></div>
</body>
<script>
    // 官网地址： https://developers.arcgis.com/esri-leaflet/api-reference/layers/feature-layer/
    // 添加底图
    const imageURL = 'http://t0.tianditu.gov.cn/DataServer?T=vec_w&x={x}&y={y}&l={z}&tk=94062428027398766a1d0f3000b5dc6c'


    let osm = L.tileLayer(imageURL, { crs: L.CRS.EPSG3857 });

    // 创建地图
    let map = L.map("map", {
        minZoom: 1, //最小缩放值
        maxZoom: 18, //最大缩放值
        zoom: 9, //初始缩放值

        zoomControl: true, //是否启用地图缩放控件
        attributionControl: false, //是否启用地图属性控件
    }).setView([33.523079, 116.477051]).addLayer(osm);


    //添加矢量标记
    var url1 = 'http://t0.tianditu.gov.cn/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk=94062428027398766a1d0f3000b5dc6c'
    L.tileLayer(url1, {
        maxZoom: 18,
        interactive: true
    }).addTo(map)

    var featureLayer = L.esri.featureLayer({
        url: "https://mapservice.tdtah.cn/server1/rest/services/AHDISA/MapServer/0",
        // url: "https://mapservice.tdtah.cn/server1/rest/services/2022ZHUANTI/1DZGY/MapServer/0",
        // layers: [0],
        useCors: false,
        zIndex: 999,
        interactive: true,
        //提供了一个机会来内省层中的单个GeoON特征。
        onEachFeature: function (feature, layer) {
            // 这里设置要处理的点击事件
            console.log(123)
            console.log(feature.properties.NAME);
        }
    });
    map.addLayer(featureLayer)

    //当新功能开始加载时触发。
    featureLayer.on('load', iterateFeatures);
    function iterateFeatures() {
        //针对每个特征调用传递的函数。该函数将被传递代表该特征的层。
        // featureLayer.eachFeature(function (layer) {
        //     console.log(layer.feature);
        // });

        //请求关于此功能层的元数据。回调将被调用error和metadata。
        featureLayer.metadata(function (error, metadata) {
            console.log(metadata);
        });

    }
    //返回一个新的L.esri.Query  可用于查询此层的对象。您的回调函数将被传递一个带有结果或错误的GeoJSON FeatureCollection。
    featureLayer.query()
        .where("NAME = '滁州市'")
        .run(function (error, featureCollection) {
            console.log(featureCollection);
        });


    //地图点击事件
    map.on('click', function (e) {
        featureLayer.eachFeature(function (layer) {
            console.log(layer.feature.properties.NAME);
        });

        var a = featureLayer.getFeature()
        // 获取点击位置的坐标
        console.log(e.latlng)
    })
</script>

</html>